openapi: 3.0.1
info:
  title: IOBWS 3.0 Documents
  version: "3.0"
  description: |
    #Summary
    This is an independent document but delivered as an part of IOBWS version 3.0 of the Icelandic banking API standard.
    The new standard is defined as an RESTful API to make it easier for programmers of any programming language without
    compromize security and follow standards.

    The document API is defined for both not durable and durable medium. Durability is controlled using the document types.

  license:
    name: Creative Commons Attribution 4.0 International Public License
    url: https://creativecommons.org/licenses/by/4.0/
  contact:
    name: Stadlarad Islands
    url: https://www.stadlar.is

paths:

  #####################################################
  # Document Service
  #####################################################

  /v1/documents/{document-store-location}/{sender-kennitala}/{documents-id}:

    get:
      summary: Get single document batch
      description: |
        Get single batch by id
      operationId: getSingleDocumentBatch
      tags:
        - Document Service
      security:
      #####################################################
      # REMARKS ON SECURITY IN THIS OPENAPI FILE
      # In this file only the basic security element to transport
      # the bearer token of an OAuth2 process, which has to
      # be included in the HTTP header is described.
      #
      # WARNING:
      # If you want to use this file for a productive implementation,
      # it is recommended to adjust the security schemes according to
      # your system environments and security policies.
      #####################################################
        - {}
        - BearerAuthOAuth: []
      parameters:
      #path
        - $ref: "#/components/parameters/documentStoreLocation"
        - $ref: "#/components/parameters/senderKennitala"
        - $ref: "#/components/parameters/documentsId"
      #query # NO QUERY PARAMETER
      #header
        #mandatory header parameter
        - $ref: "#/components/parameters/X-Request-ID"
          #optional header parameters
        - $ref: "#/components/parameters/PSU-IP-Address_optional"
        - $ref: "#/components/parameters/Authorization"
        #NO REQUEST BODY

      responses:
        '200':
          $ref: "#/components/responses/OK_200_DocumentBatchWithStatusDetails"
        '400':
          $ref: "#/components/responses/BAD_REQUEST_400"
        '401':
          $ref: "#/components/responses/UNAUTHORIZED_401"
        '403':
          $ref: "#/components/responses/FORBIDDEN_403"
        '404':
          $ref: "#/components/responses/NOT_FOUND_404"
        '405':
          $ref: "#/components/responses/METHOD_NOT_ALLOWED_405"
        '408':
          $ref: "#/components/responses/REQUEST_TIMEOUT_408"
        '415':
          $ref: "#/components/responses/UNSUPPORTED_MEDIA_TYPE_415"
        '500':
          $ref: "#/components/responses/INTERNAL_SERVER_ERROR_500"
        '503':
          $ref: "#/components/responses/SERVICE_UNAVAILABLE_503"

    put:
      summary: Update document
      description: |
        Update document batch if the document type allows it. User can choose to only send new or changes files
      operationId: update
      tags:
        - Document Service

      security:
      #####################################################
      # REMARKS ON SECURITY IN THIS OPENAPI FILE
      # In this file only the basic security element to transport
      # the bearer token of an OAuth2 process, which has to
      # be included in the HTTP header is described.
      #
      # WARNING:
      # If you want to use this file for a productive implementation,
      # it is recommended to adjust the security schemes according to
      # your system environments and security policies.
      #####################################################
        - {}
        - BearerAuthOAuth: []

      parameters:
      #path
        - $ref: "#/components/parameters/documentStoreLocation"
        - $ref: "#/components/parameters/senderKennitala"
        - $ref: "#/components/parameters/documentsId"
      #query # NO QUERY PARAMETER
      #header
        #mandatory header parameter
        - $ref: "#/components/parameters/X-Request-ID"
          #optional header parameters
        - $ref: "#/components/parameters/PSU-IP-Address_optional"
        - $ref: "#/components/parameters/Authorization"
        #NO REQUEST BODY

      requestBody:
        $ref: "#/components/requestBodies/documentBatchInitiation"


      responses:
        '200':
          $ref: "#/components/responses/OK_200_UpdateDocumentBatch"
        '400':
          $ref: "#/components/responses/BAD_REQUEST_400"
        '401':
          $ref: "#/components/responses/UNAUTHORIZED_401"
        '403':
          $ref: "#/components/responses/FORBIDDEN_403"
        '404':
          $ref: "#/components/responses/NOT_FOUND_404"
        '405':
          $ref: "#/components/responses/METHOD_NOT_ALLOWED_405"
        '406':
          $ref: "#/components/responses/NOT_ACCEPTABLE_406"
        '408':
          $ref: "#/components/responses/REQUEST_TIMEOUT_408"
        '409':
          $ref: "#/components/responses/CONFLICT_409"
        '415':
          $ref: "#/components/responses/UNSUPPORTED_MEDIA_TYPE_415"
        '429':
          $ref: "#/components/responses/TOO_MANY_REQUESTS_429"
        '500':
          $ref: "#/components/responses/INTERNAL_SERVER_ERROR_500"
        '503':
          $ref: "#/components/responses/SERVICE_UNAVAILABLE_503"

  /v1/documents/{documentStoreLocation}:

    get:
      summary: Query already uploaded document batch
      description: |
        Find uploaded document by query date range. Only the document sender can search for the document.
        The document owner goes thought the banks portal.
      operationId: searchForDocumentBatch
      tags:
        - Document Service
      security:
        - {}
        - BearerAuthOAuth: []
      parameters:
        #path
        - $ref: "#/components/parameters/documentStoreLocation"
        #query
        - $ref: "#/components/parameters/senderKennitalaQuery"
        - $ref: "#/components/parameters/receiverKennitala"
        - $ref: "#/components/parameters/documentTypeCode"
        - $ref: "#/components/parameters/status"
        - $ref: "#/components/parameters/dateFrom"
        - $ref: "#/components/parameters/dateTo"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/itemsPerPage"
        - $ref: "#/components/parameters/reference"
        #header
          #mandatory header parameter
        - $ref: "#/components/parameters/X-Request-ID"
          #optional header parameters
        - $ref: "#/components/parameters/PSU-IP-Address_optional"
        - $ref: "#/components/parameters/Authorization"
        #NO REQUEST BODY

      responses:
        '200':
          $ref: "#/components/responses/OK_200_DocumentBatchListWithStatusDetails"
        '400':
          $ref: "#/components/responses/BAD_REQUEST_400"
        '401':
          $ref: "#/components/responses/UNAUTHORIZED_401"
        '403':
          $ref: "#/components/responses/FORBIDDEN_403"
        '404':
          $ref: "#/components/responses/NOT_FOUND_404"
        '405':
          $ref: "#/components/responses/METHOD_NOT_ALLOWED_405"
        '406':
          $ref: "#/components/responses/NOT_ACCEPTABLE_406"
        '408':
          $ref: "#/components/responses/REQUEST_TIMEOUT_408"
        '409':
          $ref: "#/components/responses/CONFLICT_409"
        '415':
          $ref: "#/components/responses/UNSUPPORTED_MEDIA_TYPE_415"
        '429':
          $ref: "#/components/responses/TOO_MANY_REQUESTS_429"
        '500':
          $ref: "#/components/responses/INTERNAL_SERVER_ERROR_500"
        '503':
          $ref: "#/components/responses/SERVICE_UNAVAILABLE_503"

    post:
      summary: Upload and store new document
      description: Upload and store new document
      operationId: uploadDocument
      tags:
        - Document Services
      security:
        - {}
        - BearerAuthOAuth: []
      parameters:
      #path
        - $ref: "#/components/parameters/documentStoreLocation"
      #query
      #header
        #common header parameter
        - $ref: "#/components/parameters/X-Request-ID"
        #header to support the signature function
        - $ref: "#/components/parameters/Digest"
        - $ref: "#/components/parameters/Signature"
        - $ref: "#/components/parameters/Signature-Certificate"
        #mandatory header parameter
        #optional header parameters
        - $ref: "#/components/parameters/PSU-IP-Address_optional"
        - $ref: "#/components/parameters/Authorization"

      requestBody:
        $ref: "#/components/requestBodies/documentBatchInitiation"

      responses:
        '200':
          $ref: "#/components/responses/OK_200_DocumentBatchWithStatusDetails"
        '400':
          $ref: "#/components/responses/BAD_REQUEST_400"
        '401':
          $ref: "#/components/responses/UNAUTHORIZED_401"
        '403':
          $ref: "#/components/responses/FORBIDDEN_403"
        '404':
          $ref: "#/components/responses/NOT_FOUND_404"
        '405':
          $ref: "#/components/responses/METHOD_NOT_ALLOWED_405"
        '408':
          $ref: "#/components/responses/REQUEST_TIMEOUT_408"
        '409':
          $ref: "#/components/responses/CONFLICT_409"
        '415':
          $ref: "#/components/responses/UNSUPPORTED_MEDIA_TYPE_415"
        '500':
          $ref: "#/components/responses/INTERNAL_SERVER_ERROR_500"
        '503':
          $ref: "#/components/responses/SERVICE_UNAVAILABLE_503"

  /v1/documents/{documentStoreLocation}/types:

    get:
      summary: Get list of all document types
      description: |
        Get list of all document types. Document types control if document can be updated
      operationId: getDocumentTypeList
      tags:
        - Document Service
      security:
        - {}
        - BearerAuthOAuth: []
      parameters:
        #path
        - $ref: "#/components/parameters/documentStoreLocation"
        #query # NO PATH PARAMETERS
        #header
          #mandatory header parameter
        - $ref: "#/components/parameters/X-Request-ID"
          #optional header parameters
        - $ref: "#/components/parameters/PSU-IP-Address_optional"
        - $ref: "#/components/parameters/Authorization"
        #NO REQUEST BODY

      responses:
        '200':
          $ref: "#/components/responses/OK_200_DocumentTypeDetails"
        '400':
          $ref: "#/components/responses/BAD_REQUEST_400"
        '401':
          $ref: "#/components/responses/UNAUTHORIZED_401"
        '403':
          $ref: "#/components/responses/FORBIDDEN_403"
        '404':
          $ref: "#/components/responses/NOT_FOUND_404"
        '405':
          $ref: "#/components/responses/METHOD_NOT_ALLOWED_405"
        '406':
          $ref: "#/components/responses/NOT_ACCEPTABLE_406"
        '408':
          $ref: "#/components/responses/REQUEST_TIMEOUT_408"
        '409':
          $ref: "#/components/responses/CONFLICT_409"
        '415':
          $ref: "#/components/responses/UNSUPPORTED_MEDIA_TYPE_415"
        '429':
          $ref: "#/components/responses/TOO_MANY_REQUESTS_429"
        '500':
          $ref: "#/components/responses/INTERNAL_SERVER_ERROR_500"
        '503':
          $ref: "#/components/responses/SERVICE_UNAVAILABLE_503"

components:
#####################################################
# Predefined Components
#####################################################

  securitySchemes:
  #####################################################
  # Predefined Security Schemes:
  #
  # In this file only the basic security element to transport
  # the bearer token of an OAuth2 process, which has to
  # be included in the HTTP header is described.
  #
  # WARNING:
  # If you want to use this file for a productive implementation,
  # it is recommended to adjust the security schemes according to
  # your system environments and security policies.
  #####################################################
    BearerAuthOAuth:
      description: |
        Bearer Token.

        Is contained only, if an OAuth2 based authentication was performed in a pre-step or
        an OAuth2 based SCA was performed in a preceding AIS service in the same session.
      type: http
      scheme: bearer

  parameters:
    #####################################################
    # Predefined Parameters
    #####################################################

    Authorization:
      name: Authorization
      in: header
      description: |
        This field  might be used in case where a consent was agreed between ASPSP and PSU through an OAuth2 based protocol,
        facilitated by the TPP.
      required: false
      schema:
        $ref: "#/components/schemas/authorization"

    X-Request-ID:
      name: X-Request-ID
      in: header
      description: ID of the request, unique to the call, as determined by the initiating party.
      required: true
      example: "99391c7e-ad88-49ec-a2ad-99ddcb1f7721"
      schema:
        type: string
        format: uuid

    Digest:
      name: Digest
      in: header
      description: Is contained if and only if the "Signature" element is contained in the header of the request.
      schema:
        type: string
      required: false # conditional
      example: "SHA-256=hl1/Eps8BEQW58FJhDApwJXjGY4nr1ArGDHIT25vq6A="

    Signature:
      name: Signature
      in: header
      description: |
        A signature of the request by the TPP on application level. This might be mandated by ASPSP.
      schema:
        type: string
      required: false # conditional

    Signature-Certificate:
      name: Signature-Certificate
      in: header
      description: |
        The certificate used for signing the request, in base64 encoding.
        Must be contained if a signature is contained.
      schema:
        type: string
        format: byte
      required: false # conditional

    PSU-IP-Address_optional:
      name: PSU-IP-Address
      in: header
      description: |
        The forwarded IP Address header field consists of the corresponding http request IP Address field between PSU and TPP.
      schema:
        type: string
        format: ipv4
      required: false
      example: 192.168.8.78

    documentsId:
      name: documents-id
      in: path
      description: |
        Document id in path
      required: true
      schema:
        $ref: "#/components/schemas/uuid"

    documentStoreLocation:
      name: document-store-location
      in: path
      required: true
      schema:
        type: string

    page:
      name: page
      in: query
      description: OK
      required: true
      schema:
        type: integer

    itemsPerPage:
      name: itemsPerPage
      in: query
      description: OK
      required: true
      schema:
        type: integer

    dateFrom:
      name: dateFrom
      in: query
      description: |
        Conditional: Starting date (inclusive the date dateFrom) of the document list
      required: false
      schema:
        type: string
        format: date

    dateTo:
      name: dateTo
      in: query
      description: |
        End date (inclusive the data dateTo) of the document list
      required: false
      schema:
        type: string
        format: date

    senderKennitalaQuery:
      name: senderKennitala
      in: query
      description: |
        Kennitala
      required: true
      type: string
      minLength: 10
      maxLenght: 10

    senderKennitala:
      name: sender-kennitala
      in: path
      description: |
        Kennitala of the documents sender
      required: true
      type: string
      minLength: 10
      maxLenght: 10

    receiverKennitala:
      name: receiverKennitala
      in: query
      description: |
        Kennitala
      required: false
      type: string
      maxLenght: 10

    documentTypeCode:
      name: documentTypeCode
      in: query
      description: |
        Document Type Code
      required: false
      type: string
      maxLenght: 10

    status:
      name: status
      in: query
      description: |
        Process status
      required: false
      schema:
        $ref: "#/components/schemas/processStatus"

    reference:
      name: reference
      in: query
      description: |
        File reference
      required: false
      schema:
        $ref: "#/components/schemas/fileReference"

  schemas:
    #####################################################
    # Predefined Schemas
    #####################################################

    #####################################################
    # _links
    #####################################################

    hrefType:
      description: Link to a resource.
      type: object
      properties:
        href:
          $ref: "#/components/schemas/hrefEntry"

    hrefEntry:
      description: Link to a resource.
      type: string

    _linksAll:
      description: |
        A _link object with all availabel link types.
      type: object
      additionalProperties:
        $ref: "#/components/schemas/hrefType"
      properties:
        scaRedirect:
          $ref: "#/components/schemas/hrefType"
        scaOAuth:
          $ref: "#/components/schemas/hrefType"
        confirmation:
          $ref: "#/components/schemas/hrefType"
        startAuthorisation:
          $ref: "#/components/schemas/hrefType"
        startAuthorisationWithPsuIdentification:
          $ref: "#/components/schemas/hrefType"
        updatePsuIdentification:
          $ref: "#/components/schemas/hrefType"
        startAuthorisationWithProprietaryData:
          $ref: "#/components/schemas/hrefType"
        updateProprietaryData:
          $ref: "#/components/schemas/hrefType"
        startAuthorisationWithPsuAuthentication:
          $ref: "#/components/schemas/hrefType"
        updatePsuAuthentication:
          $ref: "#/components/schemas/hrefType"
        startAuthorisationWithEncryptedPsuAuthentication:
          $ref: "#/components/schemas/hrefType"
        updateEncryptedPsuAuthentication:
          $ref: "#/components/schemas/hrefType"
        updateAdditionalPsuAuthentication:
          $ref: "#/components/schemas/hrefType"
        updateAdditionalEncryptedPsuAuthentication:
          $ref: "#/components/schemas/hrefType"
        startAuthorisationWithAuthenticationMethodSelection:
          $ref: "#/components/schemas/hrefType"
        selectAuthenticationMethod:
          $ref: "#/components/schemas/hrefType"
        startAuthorisationWithTransactionAuthorisation:
          $ref: "#/components/schemas/hrefType"
        self:
          $ref: "#/components/schemas/hrefType"
        status:
          $ref: "#/components/schemas/hrefType"
        scaStatus:
          $ref: "#/components/schemas/hrefType"
        first:
          $ref: "#/components/schemas/hrefType"
        next:
          $ref: "#/components/schemas/hrefType"
        previous:
          $ref: "#/components/schemas/hrefType"
        last:
          $ref: "#/components/schemas/hrefType"
        download:
          $ref: "#/components/schemas/hrefType"

    authorization:
      description: |
        Authorization by OAuth2 based Protocol.
      type: string

    fileReference:
      schema:
        type: string
        maxLength: 150

    documentTypeDetails:
      description: |
        Document details.
      type: object
      required:
        - code
        - name
        - durableMedia
      properties:
        code:
          description: Unique code for the document type.
          type: string
          maxLength: 10
        name:
          description: Short description for the document type
          type: string
          maxLength: 70
        durableMedia:
          description: |
            Control flag describing if document type is durable media. If document type
            is durable media then any document batch using this code can not be updated.
          type: boolean
        description:
          description: |
            Long description for the document
          type: string
          maxLength: 140

    documentTypeList:
      description: |
        List of document type with details.
      type: object
      required:
        - documents
      properties:
        documents:
          type: array
          items:
            $ref: "#/components/schemas/documentTypeDetails"

    fileDetails:
      description: |
        Document details.
      type: object
      required:
        - id
        - name
        - kennitala
        - fileType
      properties:
        id:
          description: Unique ID of the batch, as determined by the initiating party.
          type: string
          schema:
            $ref: "#/components/schemas/uuid"
        name:
          description: Short description for the file
          type: string
          maxLength: 70
        description:
          description: |
            The file description usually in this format: "<Company name as sender> - <Document type>"
          type: string
          maxLength: 140
        kennitala:
          description: |
            The ID Number of the receiver of the document. https://en.wikipedia.org/wiki/Icelandic_identification_number
          type: string
          maxLength: 10
        fileType:
          description: |
            File type only xml, pdf, link is allowed. Xml and pdf are physical files and link is reference to file
          type: string
          enum:
            - "XML"
            - "PDF"
        file:
          description: The file in the form of base64 encoded characters
          type: string
          format: byte
        fileRef:
          description: |
            If the file is reference to an external reference, like https://www.example.com/files/file.pdf. If the field
            'file' contains data then this field is disgarded.
          type: string
          format: uri
        reference:
          $ref: "#/components/schemas/fileReference"

    documentBatchDetails:
      description: |
        Document batch details.
      type: object
      required:
        - id
        - name
        - senderKennitala
        - documentTypeCode
        - files
      properties:
        id:
          description: |
            Unique ID of the batch, as determined by the initiating party.
          schema:
            $ref: "#/components/schemas/uuid"
        name:
          description: Short description for the batch
          type: string
          maxLength: 70
        description:
          description: |
            The file description usually in this format: "<Company name as sender> - <Document type>"
          type: string
          maxLength: 140
        senderKennitala:
          description: |
            The ID Number of the sender of the document. https://en.wikipedia.org/wiki/Icelandic_identification_number
          type: string
          minLength: 10
          maxLength: 10
        documentTypeCode:
          description: |
            Document type code
          type: string
        files:
          type: array
          items:
            $ref: "#/components/schemas/fileDetails"

    processStatus:
      description: |
        Process status. The value is one of the following:
        - "received":             The document(s) has been received but processing has not started
        - "inProgress":           The document(s) is being processed
        - "completed":            The document(s) has been processed
        - "completedWithErrors":  The document(s) has been processed with errors
        - "failed":               Failed to process document
      type: string
      enum:
        - "received"
        - "inProgress"
        - "completed"
        - "completedWithErrors"
        - "failed"

    fileWithStatusDetails:
      description: |
        Document details.
      type: object
      required:
        - id
        - name
        - kennitala
        - status
      properties:
        id:
          description: Unique ID of the batch, as determined by the initiating party.
          type: string
          schema:
            $ref: "#/components/schemas/uuid"
        name:
          description: Short description for the file
          type: string
          maxLength: 70
        description:
          description: |
            The file description usually in this format: "<Company name as sender> - <Document type>"
          type: string
          maxLength: 140
        receiverKennitala:
          description: |
            The ID Number of the receiver of the document. https://en.wikipedia.org/wiki/Icelandic_identification_number
          type: string
          maxLength: 10
        fileType:
          description: |
            File type only xml, pdf, link is allowed. Xml and pdf are physical files and link is reference to file
          type: string
          enum:
            - "XML"
            - "PDF"
        status:
          $ref: "#/components/schemas/processStatus"
        statusMessage:
          description: Process status message
          type: string
          maxLength: 250
        reference:
          description: File reference, can be claim no. or any other meaningful reference
          type: string
          maxLength: 70

    documentBatchWithStatusDetails:
      description: |
        Document batch details.
      type: object
      required:
        - id
        - name
        - kennitala
        - documentTypeCode
        - files
      properties:
        id:
          description: |
            Unique ID of the batch, as determined by the initiating party.
          $ref: "#/components/schemas/uuid"
        name:
          description: Short description for the batch
          type: string
          maxLength: 70
        description:
          description: |
            The file description usually in this format: "<Company name as sender> - <Document type>"
          type: string
          maxLength: 140
        senderKennitala:
          description: |
            The ID Number of the sender of the document. https://en.wikipedia.org/wiki/Icelandic_identification_number
          type: string
          maxLength: 10
        documentTypeCode:
          description: |
            Document type code
          type: string
        status:
          $ref: "#/components/schemas/processStatus"
        files:
          type: array
          items:
            $ref: "#/components/schemas/fileWithStatusDetails"

    documentBatchWithStatusList:
      description: |
        List of documents with details.
      type: object
      required:
        - documents
      properties:
        documents:
          type: array
          items:
            $ref: "#/components/schemas/documentBatchWithStatusDetails"

    uuid:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      minLength: 36
      maxLength: 36

    #####################################################
    # Standard messages
    #####################################################

    messageCategory:
      description: Category of the message category.
      type: string
      enum:
        - "ERROR"
        - "WARNING"

    MessageCode2XX:
      description: Message codes for HTTP Error codes 2XX.
      type: string
      enum:
        - "WARNING"

    MessageCode400:
      description: Message codes defined for AIS for HTTP Error code 400 (BAD_REQUEST).
      type: string
      enum:
        - "FORMAT_ERROR"              #gen
        - "PARAMETER_NOT_CONSISTENT"  #gen
        - "PARAMETER_NOT_SUPPORTED"   #gen
        - "SERVICE_INVALID"           #gen
        - "RESOURCE_UNKNOWN"          #gen
        - "RESOURCE_EXPIRED"          #gen
        - "RESOURCE_BLOCKED"          #gen
        - "TIMESTAMP_INVALID"         #gen
        - "PERIOD_INVALID"            #gen
        - "SCA_METHOD_UNKNOWN"        #gen
        - "SCA_INVALID"               #gen
        - "CONSENT_UNKNOWN"           #gen
        - "SESSIONS_NOT_SUPPORTED"    #AIS

    MessageCode401:
      description: Message codes defined for AIS for HTTP Error code 401 (UNAUTHORIZED).
      type: string
      enum:
        - "CERTIFICATE_INVALID"       #gen
        - "ROLE_INVALID"              #gen
        - "CERTIFICATE_EXPIRED"       #gen
        - "CERTIFICATE_BLOCKED"       #gen
        - "CERTIFICATE_REVOKE"        #gen
        - "CERTIFICATE_MISSING"       #gen
        - "SIGNATURE_INVALID"         #gen
        - "SIGNATURE_MISSING"         #gen
        - "CORPORATE_ID_INVALID"      #gen
        - "PSU_CREDENTIALS_INVALID"   #gen
        - "CONSENT_INVALID"           #gen, AIS
        - "CONSENT_EXPIRED"           #gen
        - "TOKEN_UNKNOWN"             #gen
        - "TOKEN_INVALID"             #gen
        - "TOKEN_EXPIRED"             #gen

    MessageCode403:
      description: Message codes defined for AIS for HTTP Error code 403 (FORBIDDEN).
      type: string
      enum:
        - "CONSENT_UNKNOWN"           #gen
        - "SERVICE_BLOCKED"           #gen
        - "RESOURCE_UNKNOWN"          #gen
        - "RESOURCE_EXPIRED"          #gen

    MessageCode404:
      description: Message codes defined for AIS for HTTP Error code 404 (NOT FOUND).
      type: string
      enum:
        - "RESOURCE_UNKNOWN"          #gens

    MessageCode405:
      description: Message codes defined for AIS for HTTP Error code 405 (METHOD NOT ALLOWED).
      type: string
      enum:
        - "SERVICE_INVALID"           #gens

    MessageCode406:
      description: Message codes defined for AIS for HTTP Error code 406 (NOT ACCEPTABLE).
      type: string
      enum:
        - "REQUESTED_FORMATS_INVALID"  #AIS

    MessageCode409:
      description: Message codes defined for AIS for HTTP Error code 409 (CONFLICT).
      type: string
      enum:
        - "STATUS_INVALID"            #gen

    MessageCode429:
      description: Message codes for HTTP Error code 429 (TOO MANY REQUESTS).
      type: string
      enum:
        - "ACCESS_EXCEEDED"           #AIS

    #####################################################
    # Proprietary messages
    #####################################################

    messageText:
      description: Additional explaining text.
      type: string
      maxLength: 500

    message2XX:
      type: object
      required:
        - category
        - code
      properties:
        category:
           $ref: "#/components/schemas/messageCategory"
        code:
          $ref: "#/components/schemas/MessageCode2XX"
        path:
          type: string
        text:
          $ref: "#/components/schemas/messageText"

    message400:
      type: object
      required:
        - category
        - code
      properties:
        category:
           $ref: "#/components/schemas/messageCategory"
        code:
          $ref: "#/components/schemas/MessageCode400"
        path:
          type: string
        text:
          $ref: "#/components/schemas/messageText"

    message401:
      type: object
      required:
        - category
        - code
      properties:
        category:
           $ref: "#/components/schemas/messageCategory"
        code:
          $ref: "#/components/schemas/MessageCode401"
        path:
          type: string
        text:
          $ref: "#/components/schemas/messageText"

    message403:
      type: object
      required:
        - category
        - code
      properties:
        category:
           $ref: "#/components/schemas/messageCategory"
        code:
          $ref: "#/components/schemas/MessageCode403"
        path:
          type: string
        text:
          $ref: "#/components/schemas/messageText"

    message404:
      type: object
      required:
        - category
        - code
      properties:
        category:
           $ref: "#/components/schemas/messageCategory"
        code:
          $ref: "#/components/schemas/MessageCode404"
        path:
          type: string
        text:
          $ref: "#/components/schemas/messageText"

    message405:
      type: object
      required:
        - category
        - code
      properties:
        category:
           $ref: "#/components/schemas/messageCategory"
        code:
          $ref: "#/components/schemas/MessageCode405"
        path:
          type: string
        text:
          $ref: "#/components/schemas/messageText"

    message406:
      type: object
      required:
        - category
        - code
      properties:
        category:
           $ref: "#/components/schemas/messageCategory"
        code:
          $ref: "#/components/schemas/MessageCode406"
        path:
          type: string
        text:
          $ref: "#/components/schemas/messageText"

    message409:
      type: object
      required:
        - category
        - code
      properties:
        category:
           $ref: "#/components/schemas/messageCategory"
        code:
          $ref: "#/components/schemas/MessageCode409"
        path:
          type: string
        text:
          $ref: "#/components/schemas/messageText"

    message429:
      type: object
      required:
        - category
        - code
      properties:
        category:
           $ref: "#/components/schemas/messageCategory"
        code:
          $ref: "#/components/schemas/MessageCode429"
        path:
          type: string
        text:
          $ref: "#/components/schemas/messageText"


    #####################################################
    # RFC7807 Messages
    #####################################################

    errorTitle:
      description: |
        Short human readable description of error type.
        Could be in local language.
        To be provided by ASPSPs.
      type: string
      maxLength: 70

    errorDetail:
      description: |
        Detailed human readable text specific to this instance of the error.
        XPath might be used to point to the issue generating the error in addition.
        Remark for Future: In future, a dedicated field might be introduced for the XPath.
      type: string
      maxLength: 500

    #####################################################
    # RFC7807 Messages
    #####################################################

    Error400:
      description: |
        Standardised definition of reporting error information according to [RFC7807]
        in case of a HTTP error code 400 for AIS.
      type: object
      required:
        - type
        - code
      properties:
        type:
          description: |
            A URI reference [RFC3986] that identifies the problem type.
          type: string
          format: uri
          maxLength: 70
        title:
          description: |
            Short human readable description of error type.
            Could be in local language.
            To be provided by ASPSPs.
          type: string
          maxLength: 70
        detail:
          description: |
            Detailed human readable text specific to this instance of the error.
            XPath might be used to point to the issue generating the error in addition.
            Remark for Future: In future, a dedicated field might be introduced for the XPath.
          type: string
          maxLength: 500
        code:
          $ref: "#/components/schemas/MessageCode400"
        additionalErrors:
          description: |
            Array of Error Information Blocks.

            Might be used if more than one error is to be communicated
          type: array
          items: #ErrorInformation
            description: This is a data element to support the declaration of additional errors in the context of [RFC7807].
            type: object
            required:
              - code
            properties:
              title:
                $ref: "#/components/schemas/errorTitle"
              detail:
                $ref: "#/components/schemas/errorDetail"
              code:
                $ref: "#/components/schemas/MessageCode400"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error401:
      description: |
        Standardised definition of reporting error information according to [RFC7807]
        in case of a HTTP error code 401 for AIS.
      type: object
      required:
        - type
        - code
      properties:
        type:
          description: |
            A URI reference [RFC3986] that identifies the problem type.
          type: string
          format: uri
          maxLength: 70
        title:
          description: |
            Short human readable description of error type.
            Could be in local language.
            To be provided by ASPSPs.
          type: string
          maxLength: 70
        detail:
          description: |
            Detailed human readable text specific to this instance of the error.
            XPath might be used to point to the issue generating the error in addition.
            Remark for Future: In future, a dedicated field might be introduced for the XPath.
          type: string
          maxLength: 500
        code:
          $ref: "#/components/schemas/MessageCode401"
        additionalErrors:
          description: |
            Array of Error Information Blocks.

            Might be used if more than one error is to be communicated
          type: array
          items: #ErrorInformation
            description: This is a data element to support the declaration of additional errors in the context of [RFC7807].
            type: object
            required:
              - code
            properties:
              title:
                $ref: "#/components/schemas/errorTitle"
              detail:
                $ref: "#/components/schemas/errorDetail"
              code:
                $ref: "#/components/schemas/MessageCode401"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error403:
      description: |
        Standardised definition of reporting error information according to [RFC7807]
        in case of a HTTP error code 403 for AIS.
      type: object
      required:
        - type
        - code
      properties:
        type:
          description: |
            A URI reference [RFC3986] that identifies the problem type.
          type: string
          format: uri
          maxLength: 70
        title:
          description: |
            Short human readable description of error type.
            Could be in local language.
            To be provided by ASPSPs.
          type: string
          maxLength: 70
        detail:
          description: |
            Detailed human readable text specific to this instance of the error.
            XPath might be used to point to the issue generating the error in addition.
            Remark for Future: In future, a dedicated field might be introduced for the XPath.
          type: string
          maxLength: 500
        code:
          $ref: "#/components/schemas/MessageCode403"
        additionalErrors:
          description: |
            Array of Error Information Blocks.

            Might be used if more than one error is to be communicated
          type: array
          items: #ErrorInformation
            description: This is a data element to support the declaration of additional errors in the context of [RFC7807].
            type: object
            required:
              - code
            properties:
              title:
                $ref: "#/components/schemas/errorTitle"
              detail:
                $ref: "#/components/schemas/errorDetail"
              code:
                $ref: "#/components/schemas/MessageCode403"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error404:
      description: |
        Standardised definition of reporting error information according to [RFC7807]
        in case of a HTTP error code 404 for AIS.
      type: object
      required:
        - type
        - code
      properties:
        type:
          description: |
            A URI reference [RFC3986] that identifies the problem type.
            Remark For Future: These URI will be provided by NextGenPSD2 in future.
          type: string
          format: uri
          maxLength: 70
        title:
          description: |
            Short human readable description of error type.
            Could be in local language.
            To be provided by ASPSPs.
          type: string
          maxLength: 70
        detail:
          description: |
            Detailed human readable text specific to this instance of the error.
            XPath might be used to point to the issue generating the error in addition.
            Remark for Future: In future, a dedicated field might be introduced for the XPath.
          type: string
          maxLength: 500
        code:
          $ref: "#/components/schemas/MessageCode404"
        additionalErrors:
          description: |
            Array of Error Information Blocks.

            Might be used if more than one error is to be communicated
          type: array
          items: #ErrorInformation
            description: This is a data element to support the declaration of additional errors in the context of [RFC7807].
            type: object
            required:
              - code
            properties:
              title:
                $ref: "#/components/schemas/errorTitle"
              detail:
                $ref: "#/components/schemas/errorDetail"
              code:
                $ref: "#/components/schemas/MessageCode404"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error405:
      description: |
        Standardised definition of reporting error information according to [RFC7807]
        in case of a HTTP error code 405 for AIS.
      type: object
      required:
        - type
        - code
      properties:
        type:
          description: |
            A URI reference [RFC3986] that identifies the problem type.
            Remark For Future: These URI will be provided by NextGenPSD2 in future.
          type: string
          format: uri
          maxLength: 70
        title:
          description: |
            Short human readable description of error type.
            Could be in local language.
            To be provided by ASPSPs.
          type: string
          maxLength: 70
        detail:
          description: |
            Detailed human readable text specific to this instance of the error.
            XPath might be used to point to the issue generating the error in addition.
            Remark for Future: In future, a dedicated field might be introduced for the XPath.
          type: string
          maxLength: 500
        code:
          $ref: "#/components/schemas/MessageCode405"
        additionalErrors:
          description: |
            Array of Error Information Blocks.

            Might be used if more than one error is to be communicated
          type: array
          items: #ErrorInformation
            description: This is a data element to support the declaration of additional errors in the context of [RFC7807].
            type: object
            required:
              - code
            properties:
              title:
                $ref: "#/components/schemas/errorTitle"
              detail:
                $ref: "#/components/schemas/errorDetail"
              code:
                $ref: "#/components/schemas/MessageCode405"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error406:
      description: |
        Standardised definition of reporting error information according to [RFC7807]
        in case of a HTTP error code 406 for AIS.
      type: object
      required:
        - type
        - code
      properties:
        type:
          description: |
            A URI reference [RFC3986] that identifies the problem type.
          type: string
          format: uri
          maxLength: 70
        title:
          description: |
            Short human readable description of error type.
            Could be in local language.
            To be provided by ASPSPs.
          type: string
          maxLength: 70
        detail:
          description: |
            Detailed human readable text specific to this instance of the error.
            XPath might be used to point to the issue generating the error in addition.
            Remark for Future: In future, a dedicated field might be introduced for the XPath.
          type: string
          maxLength: 500
        code:
          $ref: "#/components/schemas/MessageCode406"
        additionalErrors:
          description: |
            Array of Error Information Blocks.

            Might be used if more than one error is to be communicated
          type: array
          items: #ErrorInformation
            description: This is a data element to support the declaration of additional errors in the context of [RFC7807].
            type: object
            required:
              - code
            properties:
              title:
                $ref: "#/components/schemas/errorTitle"
              detail:
                $ref: "#/components/schemas/errorDetail"
              code:
                $ref: "#/components/schemas/MessageCode406"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error409:
      description: |
        Standardised definition of reporting error information according to [RFC7807]
        in case of a HTTP error code 409 for AIS.
      type: object
      required:
        - type
        - code
      properties:
        type:
          description: |
            A URI reference [RFC3986] that identifies the problem type.
          type: string
          format: uri
          maxLength: 70
        title:
          description: |
            Short human readable description of error type.
            Could be in local language.
            To be provided by ASPSPs.
          type: string
          maxLength: 70
        detail:
          description: |
            Detailed human readable text specific to this instance of the error.
            XPath might be used to point to the issue generating the error in addition.
            Remark for Future: In future, a dedicated field might be introduced for the XPath.
          type: string
          maxLength: 500
        code:
          $ref: "#/components/schemas/MessageCode409"
        additionalErrors:
          description: |
            Array of Error Information Blocks.

            Might be used if more than one error is to be communicated
          type: array
          items: #ErrorInformation
            description: This is a data element to support the declaration of additional errors in the context of [RFC7807].
            type: object
            required:
              - code
            properties:
              title:
                $ref: "#/components/schemas/errorTitle"
              detail:
                $ref: "#/components/schemas/errorDetail"
              code:
                $ref: "#/components/schemas/MessageCode409"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error429:
      description: |
        Standardised definition of reporting error information according to [RFC7807]
        in case of a HTTP error code 429 for AIS.
      type: object
      required:
        - type
        - code
      properties:
        type:
          description: |
            A URI reference [RFC3986] that identifies the problem type.
          type: string
          format: uri
          maxLength: 70
        title:
          description: |
            Short human readable description of error type.
            Could be in local language.
            To be provided by ASPSPs.
          type: string
          maxLength: 70
        detail:
          description: |
            Detailed human readable text specific to this instance of the error.
            XPath might be used to point to the issue generating the error in addition.
            Remark for Future: In future, a dedicated field might be introduced for the XPath.
          type: string
          maxLength: 500
        code:
          $ref: "#/components/schemas/MessageCode429"
        additionalErrors:
          description: |
            Array of Error Information Blocks.

            Might be used if more than one error is to be communicated
          type: array
          items: #ErrorInformation
            description: |
              This is a data element to support the declaration of additional errors in the context of [RFC7807]
              in case of a HTTP error code 429 for.
            type: object
            required:
              - code
            properties:
              title:
                $ref: "#/components/schemas/errorTitle"
              detail:
                $ref: "#/components/schemas/errorDetail"
              code:
                $ref: "#/components/schemas/MessageCode429"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error400_NG:
      description: |
        IOBWS specific definition of reporting error information in case of a HTTP error code 400.
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: "#/components/schemas/message400"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error401_NG:
      description: |
        IOBWS specific definition of reporting error information in case of a HTTP error code 401.
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: "#/components/schemas/message401"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error403_NG:
      description: |
        IOBWS specific definition of reporting error information in case of a HTTP error code 403.
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: "#/components/schemas/message403"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error404_NG:
      description: |
        IOBWS specific definition of reporting error information in case of a HTTP error code 404.
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: "#/components/schemas/message404"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error405_NG:
      description: |
        IOBWS specific definition of reporting error information in case of a HTTP error code 401.
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: "#/components/schemas/message405"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error406_NG:
      description: |
        IOBWS specific definition of reporting error information in case of a HTTP error code 406.
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: "#/components/schemas/message406"
        _links:
          $ref: "#/components/schemas/_linksAll"

    Error409_NG:
      description: |
        IOBWS specific definition of reporting error information in case of a HTTP error code 409.
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: "#/components/schemas/message409"
        _links:
          $ref: "#/components/schemas/_linksAll"
      example:
        [{
          "category": "ERROR",
          "code": "STATUS_INVALID",
          "text": "additional text information of the ASPSP up to 500 characters"
        }]

    Error429_NG:
      description: |
        IOBWS specific definition of reporting error information in case of a HTTP error code 429.
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: "#/components/schemas/message429"
        _links:
          $ref: "#/components/schemas/_linksAll"
      example:
        [{
          "category": "ERROR",
          "code": "ACCESS_EXCEEDED",
          "text": "additional text information of the ASPSP up to 500 characters"
        }]

  requestBodies:
    #####################################################
    # Reusable Request Bodies
    #####################################################

    documentBatchInitiation:
      description: |
        JSON request body for a document batch inition or update request message
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/documentBatchDetails"

  headers:
    #####################################################
    # Reusable Response Header Elements
    #####################################################

    X-Request-ID:
      description: ID of the request, unique to the call, as determined by the initiating party.
      required: true
      example: "99391c7e-ad88-49ec-a2ad-99ddcb1f7721"
      schema:
        type: string
        format: uuid

    Location:
      description: |
        Location of the created resource.
      schema:
        type: string
        format: url
      required: false

  responses:
    #####################################################
    # Reusabale Responses
    #####################################################

    #####################################################
    # Positive Responses
    #####################################################

    OK_200_DocumentBatchListWithStatusDetails:
      description: Get document batch details
      headers:
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/documentBatchWithStatusList"

    OK_200_DocumentBatchWithStatusDetails:
      description: Get document batch details
      headers:
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/documentBatchWithStatusDetails"

    OK_200_UpdateDocumentBatch:
      description: OK
      headers:
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/documentBatchWithStatusDetails"

    OK_200_DocumentTypeDetails:
      description: OK
      headers:
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/documentTypeList"

    #####################################################
    # Negative Responses
    #####################################################

    BAD_REQUEST_400:
      description: Bad Request

      headers:
        Location:
          $ref: "#/components/headers/Location"
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"

      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error400_NG"

        application/problem+json:
          schema:
            $ref: "#/components/schemas/Error400"

    UNAUTHORIZED_401:
      description: Unauthorized

      headers:
        Location:
          $ref: "#/components/headers/Location"
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"

      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error401_NG"

        application/problem+json:
          schema:
             $ref: "#/components/schemas/Error401"

    FORBIDDEN_403:
      description: Forbidden

      headers:
        Location:
          $ref: "#/components/headers/Location"
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"

      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error403_NG"

        application/problem+json:
          schema:
             $ref: "#/components/schemas/Error403"

    NOT_FOUND_404:
      description: Not found

      headers:
        Location:
          $ref: "#/components/headers/Location"
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"

      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error404_NG"

        application/problem+json:
          schema:
             $ref: "#/components/schemas/Error404"

    METHOD_NOT_ALLOWED_405:
      description: Method Not Allowed

      headers:
        Location:
          $ref: "#/components/headers/Location"
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"

      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error405_NG"

        application/problem+json:
          schema:
             $ref: "#/components/schemas/Error405"

    NOT_ACCEPTABLE_406:
      description: Not Acceptable

      headers:
        Location:
          $ref: "#/components/headers/Location"
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"

      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error406_NG"
        application/problem+json:
          schema:
             $ref: "#/components/schemas/Error406"

    REQUEST_TIMEOUT_408:
      description: Request Timeout

      headers:
        Location:
          $ref: "#/components/headers/Location"
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"
      #No Response body because there are no valid message codes for AIS in case of HTTP code 408

    CONFLICT_409:
      description: Conflict

      headers:
        Location:
          $ref: "#/components/headers/Location"
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"
      content:
        application/json:
          schema:
             $ref: "#/components/schemas/Error409_NG"

        application/problem+json:
          schema:
             $ref: "#/components/schemas/Error409"

    UNSUPPORTED_MEDIA_TYPE_415:
      description: Unsupported Media Type

      headers:
        Location:
          $ref: "#/components/headers/Location"
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"
      #No Response body because there are no valid message codes for AIS in case of HTTP code 415

    TOO_MANY_REQUESTS_429:
      description: Too Many Requests

      headers:
        Location:
          $ref: "#/components/headers/Location"
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"

      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error429_NG"
        application/problem+json:

          schema:
             $ref: "#/components/schemas/Error429"

    INTERNAL_SERVER_ERROR_500:
      description: Internal Server Error
      headers:
        Location:
          $ref: "#/components/headers/Location"
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"
      #No Response body because there are no valid message codes for AIS in case of HTTP code 500

    SERVICE_UNAVAILABLE_503:
      description: Service Unavailable
      headers:
        Location:
          $ref: "#/components/headers/Location"
        X-Request-ID:
          $ref: "#/components/headers/X-Request-ID"
      #No Response body because there are no valid message codes for AIS in case of HTTP code 503

security:
  #####################################################
  # Global security options
  #####################################################
  - {}

tags:
  #####################################################
  # Predefined Tags to Group Methods
  #####################################################

  - name: Document Service
    description: |
      The component for Documents offers the following services:
        * Initiation and update of a document request
        * Status information of a document
        * Document type
